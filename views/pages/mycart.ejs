<!DOCTYPE html>
<!-- 
Template Name: Metronic - Responsive Admin Dashboard Template build with Twitter Bootstrap 3.2.0
Version: 3.4
Author: KeenThemes
Website: http://www.keenthemes.com/
Contact: support@keenthemes.com
Follow: www.twitter.com/keenthemes
Like: www.facebook.com/keenthemes
Purchase: http://themeforest.net/item/metronic-responsive-admin-dashboard-template/4021469?ref=keenthemes
License: You must have a valid license purchased only from themeforest (the above link) in order to legally use the theme for your project.
-->
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
<!--<![endif]-->

<!-- Head BEGIN -->
<head>
  <meta charset="utf-8">
  <title>蔓藤商城 －购物车 </title>

  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <meta content="Metronic Shop UI description" name="description">
  <meta content="Metronic Shop UI keywords" name="keywords">
  <meta content="keenthemes" name="author">

  <meta property="og:site_name" content="-CUSTOMER VALUE-">
  <meta property="og:title" content="-CUSTOMER VALUE-">
  <meta property="og:description" content="-CUSTOMER VALUE-">
  <meta property="og:type" content="website">
  <meta property="og:image" content="-CUSTOMER VALUE-"><!-- link to image for socio -->
  <meta property="og:url" content="-CUSTOMER VALUE-">

  <link rel="shortcut icon" href="favicon.ico">

  <!-- Fonts START -->
  <link href="http://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700|PT+Sans+Narrow|Source+Sans+Pro:200,300,400,600,700,900&amp;subset=all" rel="stylesheet" type="text/css"> 
  <!-- Fonts END -->

  <!-- Global styles START -->          
  <link href="../../assets/global/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet">
  <link href="../../assets/global/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <!-- Global styles END --> 
   
  <!-- Page level plugin styles START -->
  <link href="../../assets/global/plugins/fancybox/source/jquery.fancybox.css" rel="stylesheet">
  <link href="../../assets/global/plugins/carousel-owl-carousel/owl-carousel/owl.carousel.css" rel="stylesheet">
  <link href="../../assets/global/plugins/uniform/css/uniform.default.css" rel="stylesheet" type="text/css">
  <link href="../../assets/global/plugins/jquery-ui/ui/1.10.3/themes/smoothness/jquery-ui.css" rel="stylesheet" type="text/css"><!-- for slider-range -->
  <link href="../../assets/global/plugins/rateit/src/rateit.css" rel="stylesheet" type="text/css">
  <!-- Page level plugin styles END -->

  <!-- Theme styles START -->
  <link href="../../assets/global/css/components.css" rel="stylesheet">
  <link href="../../assets/frontend/layout/css/style.css" rel="stylesheet">
  <link href="../../assets/frontend/pages/css/style-shop.css" rel="stylesheet" type="text/css">
  <link href="../../assets/frontend/layout/css/style-responsive.css" rel="stylesheet">
  <link href="../../assets/frontend/layout/css/themes/red.css" rel="stylesheet" id="style-color">
  <link href="../../assets/frontend/layout/css/custom.css" rel="stylesheet">
  <!-- Theme styles END -->
</head>
<!-- Head END -->

<!-- Body BEGIN -->
<body class="ecommerce">
                  <input type="text" class="hidden" id="csrf" name="_csrf" value="<%=_csrf%>">

    <!-- BEGIN STYLE CUSTOMIZER -->
    
    <!-- END BEGIN STYLE CUSTOMIZER --> 

    <!-- BEGIN TOP BAR -->
    
    <!-- END TOP BAR -->
     <%-include ../public/pre-header%>
    <%-include ../public/header%>
    <!-- BEGIN HEADER -->
    
    <!-- Header END -->

    <div class="main">
      <div class="container">
        <!-- BEGIN SIDEBAR & CONTENT -->
        <div class="row margin-bottom-40">
          <!-- BEGIN CONTENT -->

            <form action="/user/cart/check" method="post">
                <input class="hidden" name="_csrf" type="text" value="<%=_csrf%>" />
          <div class="col-md-12 col-sm-12">
            <h1>我的购物车</h1>
            <%if(carts.length==0){%>
            <div class="shopping-cart-page">
              <div class="shopping-cart-data clearfix">
                <p>购物车空空的，肚子都饿扁了，伐^_^！</p>
              </div>
            </div>
            <%}else{%>
            <div class="goods-page">
              <div class="goods-data clearfix">
                <div class="table-wrapper-responsive">
                 <table summary="Shopping cart">
                                <tr>
                                    <th></th>
                                    <th class="goods-page-image">商品图片</th>
                                    <th class="goods-page-description">商品描述</th>
                                    <th class="goods-page-quantity">数量</th>
                                    <th class="goods-page-price">单价</th>
                                    <th class="goods-page-total" colspan="2">小计</th>
                                </tr>
                                
                                <%xbrands.forEach(function(xbrand,index){%>
                                    <tr id="<%=xbrand.id%>"><td colspan="7"><%=xbrand.brandName%></td></tr>
                                    <%carts.forEach(function(cart,index){%>
                                        <%if(cart.BrandId==xbrand.id){%>
                                        <tr>
                                            <td><input  name="sure" data-subtotal="<%=cart.amount*cart.Pic.picPrice%>" data-did="<%=cart.PicId%>" class="sure" type="checkbox" value="<%=cart.id%>"></td>
                                            <td class="goods-page-image">
                                                <a href="#"><img src="http://7xkj70.com1.z0.glb.clouddn.com<%=cart.Pic.cloudPath%>?imageView2/1/w/75/h/100"></a>
                                            </td>
                                            <td class="goods-page-description">
                                                <h3><a href="/item/show/<%=cart.ItemId%>?SKU=<%=cart.Pic.id%>"><%=cart.Item.name%></a></h3>
                                                <p><strong>——<%=cart.Pic.picSku%></strong></p>
                                                <em><%=cart.Item.keywords%></em>
                                            </td>

                                            <td class="goods-page-quantity">
                                                <div class="product-quantity">
                                                    <input id="product-quantity"  type="text" data-price="<%=cart.Pic.picPrice%>" data-cid="<%=cart.id%>" data-did="<%=cart.PicId%>" value="<%=cart.amount%>"   class="q-num form-control input-sm bg-warning">
                                                </div>
                                            </td>
                                            <td class="goods-page-price">
                                                <strong><span>¥</span><span class="differPrice"><%=(cart.Pic.picPrice).toFixed(2)%></span></strong>
                                            </td>
                                            <td class="goods-page-total">
                                                <strong><span>¥</span><span  class="differTotal"><%=((cart.amount*cart.Pic.picPrice)).toFixed(2)%></span></strong>
                                            </td>
                                            <td class="del-goods-col">
                                                <a class="del-goods" data-cid="<%=cart.id%>" data-bid="<%=cart.BrandId%>"></a>
                                            </td>
                                        </tr>

                                <%}%>
                                <%})%>
                                <%})%>
                            </table>
                </div>

                <div class="shopping-total">
                            <ul>
                                <li class="shopping-total-price">
                                    <em>合计</em>
                                    <strong class="price"><span>¥</span><b id="total">0.00</b></strong>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <a href="/" class="btn btn-warning" type="submit">继续购物<i class="fa fa-shopping-cart"></i></a>
                    <button id="checkout" class="btn btn-primary" disabled="disabled"  type="submit">我去买单<i class="fa fa-check"></i></button>
            </div>
            <%}%>
          </div></form>
          <!-- END CONTENT -->
        </div>
        <!-- END SIDEBAR & CONTENT -->

        <!-- BEGIN SIMILAR PRODUCTS -->
        <!-- END SIMILAR PRODUCTS -->
      </div>
    </div>


    <!-- BEGIN STEPS -->
        <%-include ../public/steps-block%>
    <!-- END STEPS -->

    <!-- BEGIN PRE-FOOTER -->
    <!-- END PRE-FOOTER -->

    <!-- BEGIN FOOTER -->
        <%-include ../public/footer%>

    <!-- END FOOTER -->

    <!-- END fast view of a product -->

    <!-- Load javascripts at bottom, this will reduce page load time -->
    <!-- BEGIN CORE PLUGINS (REQUIRED FOR ALL PAGES) -->
    <!--[if lt IE 9]>
    <script src="../../assets/global/plugins/respond.min.js"></script>  
    <![endif]-->  
    <script src="../../assets/global/plugins/jquery.min.js" type="text/javascript"></script>
    <script src="../../assets/global/plugins/jquery-migrate.min.js" type="text/javascript"></script>
    <script src="../../assets/global/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>      
    <script src="../../assets/frontend/layout/scripts/back-to-top.js" type="text/javascript"></script>
    <script src="../../assets/global/plugins/jquery-slimscroll/jquery.slimscroll.min.js" type="text/javascript"></script>
    <!-- END CORE PLUGINS -->

    <!-- BEGIN PAGE LEVEL JAVASCRIPTS (REQUIRED ONLY FOR CURRENT PAGE) -->
    <script src="../../assets/global/plugins/fancybox/source/jquery.fancybox.pack.js" type="text/javascript"></script><!-- pop up -->
    <script src="../../assets/global/plugins/carousel-owl-carousel/owl-carousel/owl.carousel.min.js" type="text/javascript"></script><!-- slider for products -->
    <script src='../../assets/global/plugins/zoom/jquery.zoom.min.js' type="text/javascript"></script><!-- product zoom -->
    <script src="../../assets/global/plugins/bootstrap-touchspin/bootstrap.touchspin2.js" type="text/javascript"></script><!-- Quantity -->
    <script src="../../assets/global/plugins/uniform/jquery.uniform.min.js" type="text/javascript"></script>
    <script src="../../assets/global/plugins/rateit/src/jquery.rateit.js" type="text/javascript"></script>
    <script src="../../assets/global/plugins/jquery-ui/ui/1.10.3/jquery-ui.js" type="text/javascript"></script><!-- for slider-range -->
    <script src="../../assets/global/scripts/cart.js" type="text/javascript"></script>


    <script src="../../assets/frontend/layout/scripts/layout.js" type="text/javascript"></script>
    <script type="text/javascript">
        jQuery(document).ready(function() {
            Layout.init();    
            Layout.initOWL();
          //  Layout.initTwitter();
            Layout.initImageZoom();
            Layout.initTouchspin();
            Layout.initUniform();
            Layout.initSliderRange();
                 Ecart.init()
            v()

            $(".del-goods").click(function(){
            var cid = $(this).data("cid")
            var bid= $(this).data("bid")
            var holder = $(this)
            $.ajax({
                type:'post',
                url:'/user/cart/delete/'+cid,
                headers:{
                  'x-csrf-token':$("#csrf").val()
                },
                success:function(result){

                   // console.log(nowtotal)

                        if(holder.parent().prev().prev().prev().prev().prev().prev().find(".sure").prop("checked")){
                            var subtotal = holder.parent().prev().find(".differTotal").text()*100
                          //  console.log('subtotal'+subtotal)
                            var evertotal = $("#total").text()*100
                            var nowtotal=((evertotal-subtotal)/100).toFixed(2)
                            $("#total").text(nowtotal)

                        }
                        if(!result.cart1){
                            var x="#"+bid
                   //     console.log(x)
                        $(x).remove()
                        }
                        
                        var everno = parseInt($("#cartno").text(),10)
                        //    console.log(everno)
                        if(everno >0){
                            var nowno = parseInt(everno-1,10)
                            $("#cartno").text(nowno)
                        }
                        holder.parent().parent().remove()
                        if(!result.cart2){
                                          $("#checkout").attr("disabled",true)

                        }

                    
                    
                }
            })
        })

         $(".sure").click(function(){
           // $("#checkout").remove(attr("disabled",disabled))
         //   if($(this).attr("checked")=="checked"){
                // $("checkout").remove(attr("disabled"))
             //   alert($(this).data('did'))
            var subtotal = $(this).parent().parent().parent().next().next().next().next().next().find(".differTotal").text()*100
            var evertotal = $("#total").text()*100
            if($(this).prop("checked")){
                var nowtotal=((evertotal+subtotal)/100).toFixed(2)
                $("#total").text(nowtotal)
              //  console.log(nowtotal)
              //  console.log($("#total").text())

            }else{
                var xnowtotal=((evertotal-subtotal)/100).toFixed(2)
                $("#total").text(xnowtotal)
             //   console.log(xnowtotal)
              //  console.log($("#total").text())

            }
            if($("input:checkbox:checked").length>0){
                $("#checkout").removeAttr("disabled")
              //  $("input:checkbox:checked").each(function(){


            }
            else{
                $("#checkout").attr("disabled",true)
            }
        //    }
        })

         $(".sure").bind('lsl',function(event){
             var sum=0
              $('.sure').each(function(){
                if($(this).prop("checked")){
                  
                 sum+=$(this).parent().parent().parent().next().next().next().next().next().find(".differTotal").text()*100
                //   console.log($(this).parent().parent().parent().next().next().next().next().next().find(".differTotal").text())

                   
                  //  console.log('1')
                }
                sum+=0
              //  console.log('2')
              })
             // console.log(sum)
             $("#total").text((sum/100).toFixed(2))

         })

         $('.sure').trigger('lsl')

        
        });
  function v(){
           $(function() {  
         $(".del-goods").bind('click',function(){
             var cid=$(this).data("cid")
             var num=$(this).data("num")
             var did=$(this).data("did")
             var holder=$(this)
              $.ajax({
                type:'post',
                url:'/user/cart/delete/'+cid,
                headers:{
                  'x-csrf-token':$("#csrf").val()
                },
                success:function(result){
                    Ecart.init()

                    var s="#"+cid
                    $(s).remove()

                }
              })
        
        })


        $(".add2cart").bind('click',function(){
                   var differ =$(this)
                   console.log($(this))

                   pid=differ.data("pid")
                   bid=differ.data("bid")
                   did=differ.data("did")

                  num=1
                  
                  
               //   console.log(pid+bid+did)


                   $.ajax({
                        url:'/user/cart/add/'+bid+'/'+pid+'/'+did+'/'+num+'?isajax=1',
                        type:'get',
                        success:function(data){
                           // alert('good')
                           if(data.success==403){
                    console.log(403)
                    $("#signin").trigger('isajax')
                  }else{
                   // alert('good')
                               Ecart.init()
  if(inarray(did,dselect)!=2){
                                      dselect.push(did)

                                }
                                                    console.log(dselect)

                           differ.attr("disabled",true)
                 }
                        },
                        error:function(data){
                           // alert('error')

                        }
                       })



              }) 
        })
        } 
    </script>
    <!-- END PAGE LEVEL JAVASCRIPTS -->
</body>
<!-- END BODY -->
</html>